<!DOCTYPE html>
<html lang="zh">

	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<title>猎聘</title>
		<link rel="stylesheet" href="../static/lib/bootstrap-3.3.7-dist/css/bootstrap.min.css" />
		<link rel="stylesheet" href="../static/css/main.css" />
		<link rel="shortcut icon" type="image/x-icon" href="../static/img/favicon.ico" />
	</head>

	<body>
		<!--导航栏 -->
		<div class="navbar navbar-default">
			<div class="container">
				<div class="navbar-header">
					<a href="index.html" class="navbar-brand"></a>
				</div>
				<!--<ul class="nav navbar-nav">				
				<li ><a href="index.html">首页</a></li>
				<li class="active"><a href="#">找职位</a></li>
				<li><a href="#">名企校招</a></li>
				<li><a href="#">宣讲会</a></li>
				<li><a href="#">空中宣讲会</a></li>
			</ul>-->
			
			<div class="col-sm-2 btn-groupn navbar-right">
				<a class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-user" id="user_name"> </span></a>
				<ul class="dropdown-menu dropdown-menu-left">
					<li>
						<a href="user-info.html" id="job_user">我的求职</a>
						<a href="company-info.html" id="job_company">我的招聘</a>
					</li>
					<!--<li>
						<a href="#">投递记录</a>
					</li>-->
					<li role="separator" class="divider"></li>
					<li>
						<a href="login.html">退出</a>
					</li>
				</ul>
			</div>
			</div>
		</div>

		<!--上-->

		<!--下-->
		<div class="container container-change-job">
			<!--container-adapt-->
			<div class="row">
				<div class="col-sm-9">
					<!--分类显示 -->

					<div class="position-classify clearfix">
						<ul class="filter active">						
							<li class="condition">
								<dl class="clearfix" data-selector="industrys" id="industry_id">
									<dt class="special">行业：</dt>
									<dd class="active" data-name="000">不限</dd>
								</dl>
							</li>
						</ul>
					</div>
				
					<!--具体显示-->
					<div class="position-list" id="position_list">	
						
					</div>
				</div>

				<div class="col-sm-3">
					<!--推荐栏1-->
					<div class="recommend-card" id="recommend_like">
						<div class="card-title clearfix" id="recommend_user"><span>|</span> 为您推荐
						</div>					
					</div>
					<!--推荐栏2-->
					<div class="recommend-card" id="recommend_hot">
						<div class="card-title clearfix"><span>|</span> 友情链接</div>
                        <a href="https://campus.liepin.com/">猎聘校园</a>
                        <a href="https://www.1010jz.com/">找兼职</a>
                        <a href="https://www.liepin.cn/">猎职网</a>
                        <a href="https://bj.597.com/">北京招聘网</a>
                        <a href="https://www.doumi.com//">大学生兼职</a>
                        <a href="https://landing.zhaopin.com/">智联招聘</a>
                        <a href="https://tuiguang.shixiseng.com/">实习僧</a>
					</div>
				</div>
			</div>

		</div>

		<div class="footer">
			©2020 猎聘 (京)-经营性-2017-0020 京公网安备11000002000001号 京ICP证030173号
		</div>
		<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
		<script src="../static/lib/jquery/jquery-3.4.1.js"></script>
		<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
		<script src="../static/lib/bootstrap-3.3.7-dist/js/bootstrap.js"></script>
		
		<script>
			
			var href = location.href
			var job_info		
			
			$(function(){
				user_judge()
				username_add()
				classify_build()
				job_get()
				job_build()
				likejob_build()
				hotjob_build()
				
				//判断 是用户还是公司
				function user_judge(){
					var user = sessionStorage.getItem('user')
					if(user == "用户"){
						$("#job_company").remove()
					}else{
					    $("#recommend_user").remove()
						$("#job_user").remove()
					}
				}
				
				//增加名字
				function username_add(){
					var date = sessionStorage.getItem('username')
					$("#user_name").append(date)
				}
				
				//分类显示
				function classify_build(){
					var classifytemp = '';
					$.ajax({
						type:"get",
						url:"../static/date/classify.json",
						dataType:"json",
						success:function(result){
							var classifylist = result.classify
							for(var i = 0; i < classifylist.length; i++){
								classifytemp += '<dd data-name="'+classifylist[i].name+'">'+classifylist[i].name+'</dd>'
							}
							$("#industry_id").append(classifytemp)
						}
					});
				}
				
				//通过ajax获取公司信息
				function job_get(){
					$.ajax({
						type:"get",
						url:"http://127.0.0.1:5000/job/test",
						dataType:"json",
						async: false,
						success:function(result){
							job_info = result
						}
					});
				}
				console.log(job_info)
				
				//左边职业显示
				function job_build(){
					var jobtemp = '';
					for(var i = 0; i < job_info.length; i++){
						jobtemp += 	'<div class="position-list-item clearfix">'+
										'<div class="col-sm-6">'+
											'<button class="title" id="position_infomation" position_id="'+job_info[i].position_id+'" >'+job_info[i].position_name+
											'</button>'+
											'<div class="info infoleft">'+
												'<div class="col-sm-8 row">'+
												'<span class="glyphicon glyphicon-map-marker">'+job_info[i].position_place+'</span>'+
												'</div>'+
												'<div class="col-sm-4">'+
												'<span class="glyphicon glyphicon-education">'+job_info[i].position_type+'</span>'+	
												'</div>'+
											'</div>'+
										'</div>'+
										'<div class="col-sm-3">'+
											'<a class="title1" href="#">'+job_info[i].company_name+'</a>'+												
										'</div>'+
										'<div class="col-sm-2">'+
											'<img class="img-change" src="'+job_info[i].company_photo+'" alt="公司Logo" />'+
										'</div>'+
									'</div>'
					}
					$("#position_list").append(jobtemp)
				}	
				
				//推荐职位
				function likejob_build(){
					var likejobtemp = '';
					var job_info_recommend = '';
                    var username = sessionStorage.getItem('username')
                    var data = {
						data:JSON.stringify({
							"username":username
						}),
					}
                    console.log(data)

                    $.ajax({
						type:"post",
						url:"http://127.0.0.1:5000/job/recommend",
						dataType:"json",
                        data:data,
						async: false,
						success:function(result){
							job_info_recommend = result
                            console.log(job_info_recommend)
						}
					});


					for(var i = 0; i < 4; i++){
						likejobtemp += '<div class="card-body clearfix">'+
									'<div class="col-sm-4">'+
										'<img src="'+job_info_recommend[i].company_photo+'" alt="公司Logo" />'+
									'</div>'+
									'<div class="col-sm-8 card-body-abr">'+
										'<button class="title" id="position_infomation" position_id="'+job_info_recommend[i].position_id+'" >'+job_info_recommend[i].position_name+'</button>'+
											'<br />'+
										'<button class="title1" href="#">'+job_info_recommend[i].company_name+'</button>'+
									'</div>'+
								'</div>'
					}
					$("#recommend_like").append(likejobtemp)
				}	

			})
			
			$(document).on("click","#position_infomation",function (){
				var position_id = $(this).attr("position_id")
				location.href="position-info.html?"+"id="+encodeURI(position_id)
			})
			
			//点击行业性质添加active
			$(document).on("click","#industry_id dd",function (){
				$("#industry_id dd").removeClass("active")
				$(this).addClass("active")
				var classify_name = $(this).attr("data-name")
				var classifyjobtemp = ''
				if(classify_name != "000"){
					$("#position_list").empty()
					$(function(){
						classifyjob_build()
							//分类显示
							function classifyjob_build(){
								for(var i = 0; i < job_info.length; i++){
									if(classify_name == job_info[i].position_type){
										classifyjobtemp += 	'<div class="position-list-item clearfix">'+
																'<div class="col-sm-6">'+
																	'<button class="title" id="position_infomation" position_id="'+job_info[i].position_id+'" >'+job_info[i].position_name+
																	'</button>'+
																	'<div class="info infoleft">'+
																		'<div class="col-sm-8 row">'+
																		'<span class="glyphicon glyphicon-map-marker">'+job_info[i].position_place+'</span>'+										
																		'</div>'+
																		'<div class="col-sm-4">'+
																		'<span class="glyphicon glyphicon-education">'+job_info[i].position_type+'</span>'+	
																		'</div>'+
																	'</div>'+
																'</div>'+
																'<div class="col-sm-3">'+
																	'<a class="title1" href="#">'+job_info[i].company_name+'</a>'+												
																'</div>'+
																'<div class="col-sm-2">'+
																	'<img src="'+job_info[i].company_photo+'" alt="公司Logo" />'+
																'</div>'+
															'</div>'
									}
									
								}
								$("#position_list").append(classifyjobtemp)
								}
					})
				}else{
					 window.location.href = 'job.html'
				}
				
			})
						
			
			
			
		</script>
		
		<!--自己的插件 -->
		<script src="../static/js/index.js"></script>
	</body>

</html>